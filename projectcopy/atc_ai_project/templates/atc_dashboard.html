<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Air Traffic Control AI System</title>
    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap&libraries=geometry"></script>
    <!-- Chart.js for Advanced Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            color: #FFFFFF;
            min-height: 100vh;
            overflow: hidden;
        }
        /* Exact Target Design Layout */
        
        .dashboard-container {
            display: flex;
            height: 100vh;
            background: #000000;
        }
        /* Left Sidebar - Navigation */
        
        .left-sidebar {
            width: 80px;
            background: #1a1a1a;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }
        
        .nav-icon {
            width: 40px;
            height: 40px;
            margin: 15px 0;
            background: #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #888;
            font-size: 18px;
        }
        
        .nav-icon:hover,
        .nav-icon.active {
            background: #007acc;
            color: white;
        }
        /* Main Content Area */
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        /* Top Header */
        
        .top-header {
            height: 60px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .mode-toggle {
            background: #333;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-toggle.demo {
            background: #ff6b35;
        }
        
        .mode-toggle.realtime {
            background: #4CAF50;
        }
        /* Dashboard Grid Layout */
        
        .dashboard-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
        }
        /* Left Panel - Map Area */
        
        .map-section {
            background: #000;
            position: relative;
            overflow: hidden;
        }
        
        #map {
            width: 100%;
            height: 100%;
            background: #000;
        }
        /* Map Controls Overlay */
        
        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .map-control-btn {
            width: 40px;
            height: 40px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .map-control-btn:hover {
            background: #007acc;
        }
        /* Right Panel - Data Panels */
        
        .right-panel {
            background: #1a1a1a;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        /* Panel Tabs */
        
        .panel-tabs {
            display: flex;
            background: #2a2a2a;
            border-bottom: 1px solid #333;
        }
        
        .panel-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: #888;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 1px solid #333;
        }
        
        .panel-tab:last-child {
            border-right: none;
        }
        
        .panel-tab.active {
            background: #007acc;
            color: white;
        }
        /* Panel Content */
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .tab-pane {
            display: none;
            height: 100%;
        }
        
        .tab-pane.active {
            display: block;
        }
        /* Flights Panel */
        
        .flights-panel {
            height: 100%;
            background: #1a1a1a;
        }
        
        .flights-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            background: #2a2a2a;
        }
        
        .flights-header h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            color: white;
            font-size: 12px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #007acc;
        }
        
        .flights-list {
            padding: 0;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        .flight-item {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .flight-item:hover {
            background: #2a2a2a;
        }
        
        .flight-callsign {
            font-weight: 600;
            font-size: 13px;
            color: #007acc;
            margin-bottom: 4px;
        }
        
        .flight-route {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
        
        .flight-details {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
        }
        /* Weather Panel */
        
        .weather-panel {
            padding: 15px;
            height: 100%;
            background: #1a1a1a;
        }
        
        .weather-header {
            margin-bottom: 20px;
        }
        
        .weather-header h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .weather-location {
            font-size: 12px;
            color: #888;
        }
        
        .weather-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .weather-card {
            background: #2a2a2a;
            border-radius: 6px;
            padding: 12px;
            border: 1px solid #333;
        }
        
        .weather-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .weather-value {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }
        
        .weather-unit {
            font-size: 12px;
            color: #888;
        }
        /* Analytics Panel */
        
        .analytics-panel {
            padding: 15px;
            height: 100%;
            background: #1a1a1a;
        }
        
        .analytics-header h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .chart-container {
            height: 200px;
            margin-bottom: 20px;
            background: #2a2a2a;
            border-radius: 6px;
            padding: 15px;
            border: 1px solid #333;
        }
        
        .chart-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        /* Status Indicators */
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: #2a2a2a;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #333;
            text-align: center;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: 600;
            color: #007acc;
            margin-bottom: 2px;
        }
        
        .status-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
        }
        /* Responsive Design */
        
        @media (max-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: 1fr 350px;
            }
        }
        
        @media (max-width: 1024px) {
            .left-sidebar {
                width: 60px;
            }
            .dashboard-grid {
                grid-template-columns: 1fr 300px;
            }
        }
        
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .logo-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #3498DB, #2ECC71);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: bold;
    }
    .system-title {
        font-size: 24px;
        font-weight: 700;
        background: linear-gradient(135deg, #3498DB, #2ECC71);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .header-controls {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    .mode-toggle {
        background: #34495E;
        border: none;
        padding: 8px 20px;
        border-radius: 25px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .mode-toggle.active {
        background: linear-gradient(135deg, #E74C3C, #C0392B);
    }
    .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        background: #2ECC71;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }
    .status-dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        
        50% {
            opacity: 0.5;
        }
    }
    /* Left Sidebar - Flight List & Controls */
    .left-sidebar {
        background: #1C2028;
        border-radius: 12px;
        border: 1px solid #2C3E50;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    .sidebar-header {
        background: #2C3E50;
        padding: 20px;
        border-bottom: 1px solid #34495E;
    }
    .sidebar-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 15px;
        color: #3498DB;
    }
    .search-controls {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .search-input {
        background: #34495E;
        border: 1px solid #4A5568;
        border-radius: 8px;
        padding: 12px;
        color: white;
        font-size: 14px;
        transition: all 0.3s ease;
    }
    .search-input:focus {
        outline: none;
        border-color: #3498DB;
        box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
    }
    .control-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }
    .btn {
        background: #3498DB;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        color: white;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .btn:hover {
        background: #2980B9;
        transform: translateY(-1px);
    }
    .btn-danger {
        background: #E74C3C;
    }
    .btn-danger:hover {
        background: #C0392B;
    }
    .btn-success {
        background: #27AE60;
    }
    .btn-success:hover {
        background: #229954;
    }
    /* Flight List */
    .flight-list {
        flex: 1;
        overflow-y: auto;
        padding: 0;
    }
    .flight-item {
        padding: 15px 20px;
        border-bottom: 1px solid #2C3E50;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .flight-item:hover {
        background: #2C3E50;
        transform: translateX(5px);
    }
    .flight-item.selected {
        background: linear-gradient(135deg, #3498DB20, #2ECC7120);
        border-left: 4px solid #3498DB;
    }
    .flight-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .flight-callsign {
        font-weight: 700;
        font-size: 16px;
        color: #3498DB;
    }
    .flight-route {
        font-size: 12px;
        color: #95A5A6;
    }
    .flight-status {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 10px;
        font-weight: 600;
    }
    .status-normal {
        background: #27AE60;
        color: white;
    }
    .status-delayed {
        background: #E74C3C;
        color: white;
    }
    .status-warning {
        background: #F39C12;
        color: white;
    }
    /* Main Map Area */
    .main-content {
        background: #1C2028;
        border-radius: 12px;
        border: 1px solid #2C3E50;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    .map-header {
        background: #2C3E50;
        padding: 15px 20px;
        border-bottom: 1px solid #34495E;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .map-title {
        font-size: 18px;
        font-weight: 700;
        color: #3498DB;
    }
    .map-controls {
        display: flex;
        gap: 10px;
    }
    .map-btn {
        background: #34495E;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        color: white;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .map-btn:hover {
        background: #4A5568;
    }
    .map-btn.active {
        background: #3498DB;
    }
    #map {
        flex: 1;
        border-radius: 0 0 12px 12px;
    }
    /* Right Sidebar - Analytics & Stats */
    .right-sidebar {
        background: #1C2028;
        border-radius: 12px;
        border: 1px solid #2C3E50;
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 20px;
        overflow-y: auto;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    .stat-card {
        background: #2C3E50;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        border: 1px solid #34495E;
    }
    .stat-value {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }
    .stat-value.flights {
        color: #3498DB;
    }
    .stat-value.alerts {
        color: #E74C3C;
    }
    .stat-value.routes {
        color: #2ECC71;
    }
    .stat-value.weather {
        color: #F39C12;
    }
    .stat-label {
        font-size: 12px;
        color: #95A5A6;
        text-transform: uppercase;
        font-weight: 600;
    }
    .chart-container {
        background: #2C3E50;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #34495E;
    }
    .chart-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 15px;
        color: #3498DB;
    }
    .chart-canvas {
        width: 100% !important;
        height: 200px !important;
    }
    /* Weather Panel */
    .weather-panel {
        background: #2C3E50;
        border-radius: 8px;
        padding: 15px;
        border: 1px solid #34495E;
    }
    .weather-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 15px;
        color: #3498DB;
    }
    .weather-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    .weather-item {
        text-align: center;
        padding: 10px;
        background: #34495E;
        border-radius: 6px;
    }
    .weather-value {
        font-size: 18px;
        font-weight: 700;
        color: #2ECC71;
    }
    .weather-label {
        font-size: 11px;
        color: #95A5A6;
        margin-top: 5px;
    }
    /* Alert Banner */
    .alert-banner {
        background: linear-gradient(135deg, #E74C3C, #C0392B);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #FFFFFF;
        animation: alertPulse 2s infinite;
    }
    @keyframes alertPulse {
        0%,
        100% {
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.3);
        }
        
        50% {
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.6);
        }
    }
    .alert-text {
        font-weight: 700;
        font-size: 14px;
    }
    /* Responsive Design */
    @media (max-width: 1400px) {
        .dashboard-container {
            grid-template-columns: 280px 1fr 320px;
        }
    }
    @media (max-width: 1200px) {
        .dashboard-container {
            grid-template-columns: 1fr;
            grid-template-rows: 80px auto auto auto;
        }
        
        .left-sidebar,
        .right-sidebar {
            height: 400px;
        }
    }
    .panel-title {
        font-size: 1.4rem;
        font-weight: 600;
        color: #fff;
    }
    .mode-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .mode-switch {
        position: relative;
        width: 100px;
        height: 30px;
        background: #444;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .mode-switch.active-demo {
        background: #4CAF50;
    }
    .mode-switch.active-realtime {
        background: #2196F3;
    }
    .mode-slider {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 44px;
        height: 24px;
        background: white;
        border-radius: 12px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: bold;
        color: #333;
    }
    .mode-switch.active-realtime .mode-slider {
        transform: translateX(50px);
    }
    .mode-label {
        font-size: 12px;
        color: #ccc;
    }
    /* Top Left Panel - System Overview */
    .system-overview {
        grid-column: 1;
        grid-row: 1;
    }
    .main-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #4CAF50;
        margin-bottom: 20px;
        text-align: center;
    }
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    .kpi-card {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #4CAF50;
    }
    .kpi-card.conflicts {
        border-left-color: #f44336;
    }
    .kpi-card.delays {
        border-left-color: #ff9800;
    }
    .kpi-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
    }
    .kpi-label {
        font-size: 0.9rem;
        color: #ccc;
    }
    .charts-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
    }
    .mini-chart {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4CAF50;
        font-size: 0.9rem;
    }
    .flight-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    .flight-table th,
    .flight-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #444;
    }
    .flight-table th {
        background: #333;
        color: #4CAF50;
        font-weight: 600;
    }
    .flight-table tr:hover {
        background: #333;
    }
    .status-normal {
        color: #4CAF50;
    }
    .status-delayed {
        color: #ff9800;
    }
    .status-conflict {
        color: #f44336;
    }
    /* Top Right Panel - Live Map */
    .live-map {
        grid-column: 2;
        grid-row: 1;
    }
    .map-container {
        background: #333;
        height: 300px;
        border-radius: 8px;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }
    /* Google Maps container */
    #map {
        width: 100%;
        height: 100%;
        border-radius: 8px;
    }
    .map-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #1e3c72, #2a5298);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        position: relative;
    }
    .flight-icon {
        position: absolute;
        width: 20px;
        height: 20px;
        background: #ffeb3b;
        border-radius: 50%;
        border: 2px solid #333;
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        
        50% {
            transform: scale(1.1);
        }
        
        100% {
            transform: scale(1);
        }
    }
    .map-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    .btn {
        padding: 8px 16px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
    }
    .btn:hover {
        background: #45a049;
    }
    .btn-danger {
        background: #f44336;
    }
    .btn-danger:hover {
        background: #da190b;
    }
    /* Middle Left Panel - Real-time Data */
    .realtime-data {
        grid-column: 1;
        grid-row: 2;
    }
    .search-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
    }
    .search-input {
        padding: 8px 12px;
        background: #333;
        border: 1px solid #555;
        border-radius: 5px;
        color: white;
        font-size: 14px;
        width: 220px;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .search-input:focus {
        outline: none;
        border-color: #007cba;
        box-shadow: 0 0 8px rgba(0, 124, 186, 0.4);
    }
    .search-input::placeholder {
        color: #999;
        font-style: italic;
    }
    .weather-section {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }
    .weather-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    .weather-item {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
    }
    .weather-radar {
        background: #222;
        height: 60px;
        border-radius: 5px;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4CAF50;
    }
    /* Middle Right Panel - Traffic Analysis */
    .traffic-analysis {
        grid-column: 2;
        grid-row: 2;
    }
    .chart-container {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4CAF50;
        font-size: 1.1rem;
    }
    .chart-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    /* Bottom Panel - Conflict Analysis */
    .conflict-analysis {
        grid-column: 1 / -1;
        grid-row: 3;
    }
    .alert-banner {
        background: #f44336;
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: bold;
        text-align: center;
        animation: blink 1s infinite;
    }
    @keyframes blink {
        0%,
        50% {
            opacity: 1;
        }
        
        51%,
        100% {
            opacity: 0.7;
        }
    }
    .conflict-map {
        background: #333;
        height: 200px;
        border-radius: 8px;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }
    .conflict-zone {
        position: absolute;
        width: 60px;
        height: 60px;
        background: rgba(244, 67, 54, 0.3);
        border: 2px solid #f44336;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: pulse 2s infinite;
    }
    .reroute-path {
        position: absolute;
        height: 2px;
        background: #4CAF50;
        top: 30%;
        left: 20%;
        width: 60%;
        transform: rotate(15deg);
    }
    .conflict-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .stat-card {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }
    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4CAF50;
        margin-bottom: 5px;
    }
    .stat-label {
        font-size: 0.9rem;
        color: #ccc;
    }
    .rerouted-flights {
        margin-top: 20px;
    }
    .last-update {
        text-align: center;
        margin-top: 20px;
        color: #999;
        font-size: 0.9rem;
    }
    @media (max-width: 1200px) {
        .dashboard-container {
            grid-template-columns: 1fr;
        }
        
        .kpi-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .charts-row {
            grid-template-columns: 1fr 1fr;
        }
    }
    @media (max-width: 768px) {
        .kpi-grid {
            grid-template-columns: 1fr;
        }
        
        .charts-row {
            grid-template-columns: 1fr;
        }
        
        .chart-grid {
            grid-template-columns: 1fr;
        }
    }
    /* Flight Details Modal Styles */
    .flight-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 10000;
        overflow-y: auto;
        padding: 20px;
    }
    .modal-content {
        background: #1a1a1a;
        border-radius: 15px;
        max-width: 1400px;
        margin: 0 auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        border: 2px solid #333;
    }
    .modal-header {
        background: linear-gradient(135deg, #2c3e50, #3498db);
        padding: 20px 30px;
        border-radius: 15px 15px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #34495e;
    }
    .modal-header h2 {
        color: white;
        margin: 0;
        font-size: 24px;
    }
    .close-modal {
        color: white;
        font-size: 32px;
        cursor: pointer;
        transition: color 0.3s ease;
    }
    .close-modal:hover {
        color: #e74c3c;
    }
    .modal-body {
        padding: 30px;
    }
    .flight-overview {
        display: grid;
        gap: 25px;
    }
    .flight-basic-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    .info-card,
    .weather-card,
    .trajectory-card,
    .visibility-card {
        background: #2a2a2a;
        border-radius: 10px;
        padding: 20px;
        border: 1px solid #444;
    }
    .info-card h3,
    .weather-card h3,
    .trajectory-card h3,
    .visibility-card h3 {
        color: #3498db;
        margin: 0 0 15px 0;
        font-size: 18px;
        border-bottom: 2px solid #3498db;
        padding-bottom: 8px;
    }
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    .info-item {
        padding: 8px 0;
        border-bottom: 1px solid #333;
    }
    .info-item strong {
        color: #95a5a6;
    }
    .info-item span {
        color: #ecf0f1;
        margin-left: 8px;
    }
    .weather-analysis {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    .weather-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
    }
    .weather-stat {
        text-align: center;
        background: #333;
        padding: 12px;
        border-radius: 8px;
    }
    .weather-value {
        font-size: 20px;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 5px;
    }
    .weather-label {
        font-size: 12px;
        color: #95a5a6;
        text-transform: uppercase;
    }
    .weather-condition {
        background: #333;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
    }
    .weather-condition strong {
        color: #95a5a6;
    }
    .weather-condition span {
        color: #f39c12;
        font-weight: bold;
    }
    .trajectory-analysis {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    .trajectory-canvas-container,
    .altitude-canvas-container {
        background: #333;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
    }
    .trajectory-stats,
    .altitude-stats {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
    }
    .traj-stat,
    .alt-stat {
        background: #333;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
    }
    .traj-stat strong,
    .alt-stat strong {
        color: #95a5a6;
        display: block;
        font-size: 12px;
        margin-bottom: 5px;
    }
    .traj-stat span,
    .alt-stat span {
        color: #2ecc71;
        font-weight: bold;
        font-size: 16px;
    }
    .sky-visibility {
        margin-top: 20px;
    }
    .visibility-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
    }
    .visibility-stat {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .vis-icon {
        font-size: 24px;
        width: 40px;
        text-align: center;
    }
    .vis-info strong {
        color: #95a5a6;
        display: block;
        font-size: 14px;
        margin-bottom: 3px;
    }
    .vis-info span {
        color: #e67e22;
        font-weight: bold;
        font-size: 16px;
    }
    .visibility-indicator {
        margin-top: 20px;
    }
    .sky-view {
        background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 30%, #98FB98 70%, #228B22 100%);
        height: 120px;
        border-radius: 10px;
        position: relative;
        overflow: hidden;
    }
    .sky-condition {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 16px;
        border-radius: 20px;
        backdrop-filter: blur(5px);
    }
    .sky-text {
        color: white;
        font-weight: bold;
        text-align: center;
    }
    /* Sky condition classes */
    .sky-clear {
        background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 30%, #98FB98 70%, #228B22 100%);
    }
    .sky-cloudy {
        background: linear-gradient(to bottom, #696969 0%, #A9A9A9 30%, #D3D3D3 70%, #228B22 100%);
    }
    .sky-stormy {
        background: linear-gradient(to bottom, #2F4F4F 0%, #556B2F 30%, #696969 70%, #2F4F4F 100%);
    }
    @media (max-width: 1200px) {
        .flight-basic-info,
        .weather-analysis,
        .trajectory-analysis {
            grid-template-columns: 1fr;
        }
        
        .visibility-grid {
            grid-template-columns: 1fr;
        }
    }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Header Bar -->
        <div class="header-bar">
            <div class="logo-section">
                <div class="logo-icon">‚úàÔ∏è</div>
                <div class="system-title">Advanced Air Traffic Control AI</div>
            </div>
            <div class="header-controls">
                <button class="mode-toggle" id="modeToggle" onclick="toggleMode()">DEMO MODE</button>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>SYSTEM ACTIVE</span>
                </div>
            </div>
        </div>

        <!-- Left Sidebar - Flight List & Controls -->
        <div class="left-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Flight Operations</div>
                <div class="search-controls">
                    <input type="text" class="search-input" placeholder="Search Flight (e.g., AA1234)" id="flightSearch">
                    <div class="control-buttons">
                        <button class="btn" onclick="searchFlight()">Search</button>
                        <button class="btn btn-success" onclick="toggleAllRoutes()">Routes</button>
                        <button class="btn btn-danger" onclick="clearRouteLines()">Clear</button>
                        <button class="btn" onclick="refreshMap()">Refresh</button>
                    </div>
                </div>
            </div>

            <div class="flight-list" id="flightList">
                <!-- Flight items will be populated here -->
            </div>
        </div>

        <!-- Main Content - Enhanced Map -->
        <div class="main-content">
            <div class="map-header">
                <div class="map-title">Live Flight Tracking</div>
                <div class="map-controls">
                    <button class="map-btn" onclick="zoomIn()">Zoom In</button>
                    <button class="map-btn" onclick="zoomOut()">Zoom Out</button>
                    <button class="map-btn active" onclick="toggleMapView()">Satellite</button>
                </div>
            </div>
            <div id="map"></div>
        </div>

        <!-- Right Sidebar - Analytics & Statistics -->
        <div class="right-sidebar">
            <!-- Alert Banner -->
            <div class="alert-banner" id="alertBanner" style="display: none;">
                <div class="alert-text">‚ö†Ô∏è ALERT: High-risk conflict detected in restricted airspace</div>
            </div>

            <!-- Key Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value flights" id="totalFlights">0</div>
                    <div class="stat-label">Active Flights</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value alerts" id="totalAlerts">0</div>
                    <div class="stat-label">Active Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value routes" id="totalRoutes">0</div>
                    <div class="stat-label">Active Routes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value weather" id="weatherStatus">Good</div>
                    <div class="stat-label">Weather</div>
                </div>
            </div>

            <!-- Flight Traffic Chart -->
            <div class="chart-container">
                <div class="chart-title">Flight Traffic (24h)</div>
                <canvas id="trafficChart" class="chart-canvas"></canvas>
            </div>

            <!-- Weather Information -->
            <div class="weather-panel">
                <div class="weather-title">Current Weather</div>
                <div class="weather-grid">
                    <div class="weather-item">
                        <div class="weather-value" id="temperature">--¬∞C</div>
                        <div class="weather-label">Temperature</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="windSpeed">-- kts</div>
                        <div class="weather-label">Wind Speed</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="visibility">-- mi</div>
                        <div class="weather-label">Visibility</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="pressure">-- hPa</div>
                        <div class="weather-label">Pressure</div>
                    </div>
                </div>
            </div>

            <!-- Airspace Utilization Chart -->
            <div class="chart-container">
                <div class="chart-title">Airspace Utilization</div>
                <canvas id="utilizationChart" class="chart-canvas"></canvas>
            </div>

            <!-- Conflict Analysis Chart -->
            <div class="chart-container">
                <div class="chart-title">Conflict Analysis</div>
                <canvas id="conflictChart" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Flight Details Modal -->
    <div id="flightDetailsModal" class="flight-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalFlightTitle">Flight Details - AA1234</h2>
                <span class="close-modal" onclick="closeFlightDetails()">&times;</span>
            </div>

            <div class="modal-body">
                <div class="flight-overview">
                    <div class="flight-basic-info">
                        <div class="info-card">
                            <h3>‚úàÔ∏è Flight Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>Callsign:</strong> <span id="modalCallsign">--</span>
                                </div>
                                <div class="info-item">
                                    <strong>Aircraft Type:</strong> <span id="modalAircraftType">--</span>
                                </div>
                                <div class="info-item">
                                    <strong>Route:</strong> <span id="modalRoute">-- ‚Üí --</span>
                                </div>
                                <div class="info-item">
                                    <strong>Status:</strong> <span id="modalStatus">--</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-card">
                            <h3>üìä Current Position</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>Altitude:</strong> <span id="modalAltitude">--</span>
                                </div>
                                <div class="info-item">
                                    <strong>Speed:</strong> <span id="modalSpeed">--</span>
                                </div>
                                <div class="info-item">
                                    <strong>Heading:</strong> <span id="modalHeading">--</span>
                                </div>
                                <div class="info-item">
                                    <strong>Coordinates:</strong> <span id="modalCoordinates">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="weather-analysis">
                        <div class="weather-card">
                            <h3>üå§Ô∏è Origin Weather (<span id="originCity">--</span>)</h3>
                            <div class="weather-grid">
                                <div class="weather-stat">
                                    <div class="weather-value" id="originTemp">--¬∞C</div>
                                    <div class="weather-label">Temperature</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="originWind">-- kts</div>
                                    <div class="weather-label">Wind Speed</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="originVisibility">-- mi</div>
                                    <div class="weather-label">Visibility</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="originPressure">-- hPa</div>
                                    <div class="weather-label">Pressure</div>
                                </div>
                            </div>
                            <div class="weather-condition">
                                <strong>Conditions:</strong> <span id="originCondition">--</span>
                            </div>
                        </div>

                        <div class="weather-card">
                            <h3>üå¶Ô∏è Destination Weather (<span id="destCity">--</span>)</h3>
                            <div class="weather-grid">
                                <div class="weather-stat">
                                    <div class="weather-value" id="destTemp">--¬∞C</div>
                                    <div class="weather-label">Temperature</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="destWind">-- kts</div>
                                    <div class="weather-label">Wind Speed</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="destVisibility">-- mi</div>
                                    <div class="weather-label">Visibility</div>
                                </div>
                                <div class="weather-stat">
                                    <div class="weather-value" id="destPressure">-- hPa</div>
                                    <div class="weather-label">Pressure</div>
                                </div>
                            </div>
                            <div class="weather-condition">
                                <strong>Conditions:</strong> <span id="destCondition">--</span>
                            </div>
                        </div>
                    </div>

                    <div class="trajectory-analysis">
                        <div class="trajectory-card">
                            <h3>üõ§Ô∏è Flight Trajectory Analysis</h3>
                            <div class="trajectory-canvas-container">
                                <canvas id="trajectoryCanvas" width="400" height="200"></canvas>
                            </div>
                            <div class="trajectory-stats">
                                <div class="traj-stat">
                                    <strong>Progress:</strong> <span id="flightProgress">--</span>%
                                </div>
                                <div class="traj-stat">
                                    <strong>ETA:</strong> <span id="flightETA">--</span>
                                </div>
                                <div class="traj-stat">
                                    <strong>Distance Remaining:</strong> <span id="distanceRemaining">--</span> nm
                                </div>
                            </div>
                        </div>

                        <div class="altitude-profile">
                            <h3>üìà Altitude Profile</h3>
                            <div class="altitude-canvas-container">
                                <canvas id="altitudeCanvas" width="400" height="200"></canvas>
                            </div>
                            <div class="altitude-stats">
                                <div class="alt-stat">
                                    <strong>Current:</strong> <span id="currentAlt">--</span> ft
                                </div>
                                <div class="alt-stat">
                                    <strong>Cruise:</strong> <span id="cruiseAlt">--</span> ft
                                </div>
                                <div class="alt-stat">
                                    <strong>Vertical Rate:</strong> <span id="verticalRate">--</span> ft/min
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sky-visibility">
                        <div class="visibility-card">
                            <h3>üëÅÔ∏è Sky Visibility Analysis</h3>
                            <div class="visibility-grid">
                                <div class="visibility-stat">
                                    <div class="vis-icon cloud-icon">‚òÅÔ∏è</div>
                                    <div class="vis-info">
                                        <strong>Cloud Coverage:</strong>
                                        <span id="cloudCoverage">--</span>%
                                    </div>
                                </div>
                                <div class="visibility-stat">
                                    <div class="vis-icon visibility-icon">üëÅÔ∏è</div>
                                    <div class="vis-info">
                                        <strong>Ground Visibility:</strong>
                                        <span id="groundVisibility">--</span> nm
                                    </div>
                                </div>
                                <div class="visibility-stat">
                                    <div class="vis-icon turbulence-icon">üå™Ô∏è</div>
                                    <div class="vis-info">
                                        <strong>Turbulence Level:</strong>
                                        <span id="turbulenceLevel">--</span>
                                    </div>
                                </div>
                                <div class="visibility-stat">
                                    <div class="vis-icon ceiling-icon">‚¨ÜÔ∏è</div>
                                    <div class="vis-info">
                                        <strong>Cloud Ceiling:</strong>
                                        <span id="cloudCeiling">--</span> ft
                                    </div>
                                </div>
                            </div>

                            <div class="visibility-indicator">
                                <div class="sky-view">
                                    <div id="skyConditionIndicator" class="sky-condition">
                                        <div class="sky-text">Current Sky Conditions</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="last-update" id="lastUpdate">
        Last updated: <span id="updateTime">--:--:--</span>
    </div>

    <script>
        let currentMode = 'DEMO'; // Start in demo mode
        let updateInterval;
        let map;
        let flightMarkers = [];
        let routeLines = [];
        let airportMarkers = [];
        let warzonePolygons = [];
        let currentSelectedFlight = null;
        let trafficChart, utilizationChart, conflictChart;
        let flightData = [];

        // Airport coordinates database
        const airportCoordinates = {
            "New York": {
                lat: 40.6413,
                lng: -73.7781,
                code: "JFK"
            },
            "Los Angeles": {
                lat: 33.9425,
                lng: -118.4081,
                code: "LAX"
            },
            "Chicago": {
                lat: 41.9742,
                lng: -87.9073,
                code: "ORD"
            },
            "Dallas": {
                lat: 32.8998,
                lng: -97.0403,
                code: "DFW"
            },
            "Atlanta": {
                lat: 33.6407,
                lng: -84.4277,
                code: "ATL"
            },
            "Denver": {
                lat: 39.8617,
                lng: -104.6731,
                code: "DEN"
            },
            "San Francisco": {
                lat: 37.6213,
                lng: -122.3790,
                code: "SFO"
            },
            "Seattle": {
                lat: 47.4502,
                lng: -122.3088,
                code: "SEA"
            },
            "Miami": {
                lat: 25.7959,
                lng: -80.2870,
                code: "MIA"
            },
            "Phoenix": {
                lat: 33.4342,
                lng: -112.0116,
                code: "PHX"
            }
        };

        // Warzone coordinates
        const warzoneAreas = [{
            name: "Eastern Restricted Zone",
            coordinates: [{
                lat: 38.0,
                lng: -77.5
            }, {
                lat: 39.0,
                lng: -77.5
            }, {
                lat: 39.0,
                lng: -76.0
            }, {
                lat: 38.0,
                lng: -76.0
            }],
            type: "restricted"
        }, {
            name: "Western Conflict Zone",
            coordinates: [{
                lat: 34.0,
                lng: -120.0
            }, {
                lat: 35.0,
                lng: -120.0
            }, {
                lat: 35.0,
                lng: -118.0
            }, {
                lat: 34.0,
                lng: -118.0
            }],
            type: "conflict"
        }];

        // Initialize Enhanced Dashboard
        function initDashboard() {
            console.log('Initializing Enhanced ATC Dashboard...');
            initCharts();
            loadData();
            updateInterval = setInterval(loadData, 5000);
        }

        // Initialize Charts
        function initCharts() {
            // Traffic Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            trafficChart = new Chart(trafficCtx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Flight Count',
                        data: [120, 80, 200, 300, 250, 180],
                        borderColor: '#3498DB',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#95A5A6'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#95A5A6'
                            }
                        }
                    }
                }
            });

            // Utilization Chart
            const utilizationCtx = document.getElementById('utilizationChart').getContext('2d');
            utilizationChart = new Chart(utilizationCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Commercial', 'Private', 'Military', 'Cargo'],
                    datasets: [{
                        data: [65, 20, 10, 5],
                        backgroundColor: ['#3498DB', '#2ECC71', '#E74C3C', '#F39C12'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#95A5A6',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });

            // Conflict Chart
            const conflictCtx = document.getElementById('conflictChart').getContext('2d');
            conflictChart = new Chart(conflictCtx, {
                type: 'bar',
                data: {
                    labels: ['Low', 'Medium', 'High', 'Critical'],
                    datasets: [{
                        label: 'Conflicts',
                        data: [5, 8, 3, 1],
                        backgroundColor: ['#2ECC71', '#F39C12', '#E67E22', '#E74C3C'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#95A5A6'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#95A5A6'
                            }
                        }
                    }
                }
            });
        }

        // Update Flight List in Sidebar
        function updateFlightList(flights) {
            const flightList = document.getElementById('flightList');
            flightList.innerHTML = '';

            flights.slice(0, 15).forEach(flight => {
                const flightItem = document.createElement('div');
                flightItem.className = 'flight-item';
                flightItem.innerHTML = `
                    <div class="flight-info">
                        <div class="flight-callsign">${flight.callsign}</div>
                        <div class="flight-route">${flight.origin} ‚Üí ${flight.destination}</div>
                    </div>
                    <div class="flight-status status-${flight.status.toLowerCase()}">${flight.status}</div>
                `;

                flightItem.addEventListener('click', () => {
                    // Remove previous selection
                    document.querySelectorAll('.flight-item').forEach(item => {
                        item.classList.remove('selected');
                    });

                    // Select this item
                    flightItem.classList.add('selected');

                    // Show flight details and route
                    showFlightDetails(flight);

                    // Find and center on map
                    const marker = flightMarkers.find(m => m.flightData && m.flightData.callsign === flight.callsign);
                    if (marker) {
                        map.panTo(marker.getPosition());
                        map.setZoom(8);
                        clearRouteLines();
                        showFlightRoute(flight);

                        marker.setAnimation(google.maps.Animation.BOUNCE);
                        setTimeout(() => marker.setAnimation(null), 2000);
                    }
                });

                flightList.appendChild(flightItem);
            });
        }

        // Enhanced Statistics Update
        function updateStatistics(data) {
            document.getElementById('totalFlights').textContent = data.flights.total || 0;
            document.getElementById('totalAlerts').textContent = Math.floor(Math.random() * 10);
            document.getElementById('totalRoutes').textContent = routeLines.length;
            document.getElementById('weatherStatus').textContent = 'Good';

            // Update weather
            if (data.weather) {
                document.getElementById('temperature').textContent = `${data.weather.temperature}¬∞C`;
                document.getElementById('windSpeed').textContent = `${data.weather.wind_speed} kts`;
                document.getElementById('visibility').textContent = `${data.weather.visibility || 10} mi`;
                document.getElementById('pressure').textContent = `${data.weather.pressure || 1013} hPa`;
            }

            // Update charts with random data for demo
            updateChartData();
        }

        // Update Chart Data
        function updateChartData() {
            // Update traffic chart
            const newTrafficData = Array.from({
                length: 6
            }, () => Math.floor(Math.random() * 300) + 50);
            trafficChart.data.datasets[0].data = newTrafficData;
            trafficChart.update('none');

            // Update utilization chart
            const newUtilData = [
                Math.floor(Math.random() * 40) + 50,
                Math.floor(Math.random() * 30) + 10,
                Math.floor(Math.random() * 20) + 5,
                Math.floor(Math.random() * 15) + 5
            ];
            utilizationChart.data.datasets[0].data = newUtilData;
            utilizationChart.update('none');

            // Update conflict chart
            const newConflictData = Array.from({
                length: 4
            }, () => Math.floor(Math.random() * 10));
            conflictChart.data.datasets[0].data = newConflictData;
            conflictChart.update('none');
        }

        // Mode Toggle Function
        function toggleMode() {
            const modeToggle = document.getElementById('modeToggle');
            if (currentMode === 'DEMO') {
                currentMode = 'REAL-TIME';
                modeToggle.textContent = 'REAL-TIME MODE';
                modeToggle.style.background = 'linear-gradient(135deg, #2ECC71, #27AE60)';
            } else {
                currentMode = 'DEMO';
                modeToggle.textContent = 'DEMO MODE';
                modeToggle.style.background = '#34495E';
            }

            // Send mode toggle request to server
            fetch('/api/toggle_mode', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => console.log('Mode switched to:', data.mode))
                .catch(error => console.error('Error toggling mode:', error));
        }

        // Map View Toggle
        function toggleMapView() {
            if (map) {
                const currentType = map.getMapTypeId();
                map.setMapTypeId(currentType === 'satellite' ? 'roadmap' : 'satellite');
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
        const totalDistance = calculateDistance(originCoords.lat, originCoords.lng, destCoords.lat, destCoords.lng);
        const currentDistance = calculateDistance(originCoords.lat, originCoords.lng, flight.latitude, flight.longitude);
        const progress = Math.round((currentDistance / totalDistance) * 100);
        const remainingDistance = Math.round(totalDistance - currentDistance);

        // Calculate ETA
        const remainingTime = remainingDistance / (flight.velocity / 60); // in hours
        const eta = new Date(Date.now() + remainingTime * 60 * 60 * 1000);

        document.getElementById('flightProgress').textContent = Math.min(progress, 100);
        document.getElementById('flightETA').textContent = eta.toLocaleTimeString();
        document.getElementById('distanceRemaining').textContent = remainingDistance;

        // Draw trajectory on canvas
        drawTrajectory(flight, originCoords, destCoords);
        }

        function generateAltitudeProfile(flight) {
            const cruiseAltitude = Math.round(flight.altitude * (0.9 + Math.random() * 0.2));
            const verticalRate = Math.round((Math.random() - 0.5) * 1000);

            document.getElementById('currentAlt').textContent = flight.altitude.toLocaleString();
            document.getElementById('cruiseAlt').textContent = cruiseAltitude.toLocaleString();
            document.getElementById('verticalRate').textContent = verticalRate;

            // Draw altitude profile
            drawAltitudeProfile(flight);
        }

        function calculateSkyVisibility(flight) {
            // Generate realistic sky conditions based on altitude and weather
            const altitude = flight.altitude;
            const cloudCoverage = Math.round(Math.random() * 100);
            const groundVis = Math.round(5 + Math.random() * 15);
            const turbulence = ['None', 'Light', 'Moderate', 'Severe'][Math.floor(Math.random() * 4)];
            const ceiling = Math.round(5000 + Math.random() * 15000);

            document.getElementById('cloudCoverage').textContent = cloudCoverage;
            document.getElementById('groundVisibility').textContent = groundVis;
            document.getElementById('turbulenceLevel').textContent = turbulence;
            document.getElementById('cloudCeiling').textContent = ceiling.toLocaleString();

            // Set sky condition visualization
            const skyIndicator = document.getElementById('skyConditionIndicator');
            const skyView = skyIndicator.parentElement;

            let skyCondition = 'Clear Skies';
            let skyClass = 'sky-clear';

            if (cloudCoverage > 70) {
                skyCondition = 'Overcast';
                skyClass = 'sky-cloudy';
            } else if (cloudCoverage > 40) {
                skyCondition = 'Partly Cloudy';
                skyClass = 'sky-cloudy';
            }

            if (turbulence === 'Severe' || turbulence === 'Moderate') {
                skyCondition = 'Stormy Conditions';
                skyClass = 'sky-stormy';
            }

            skyView.className = `sky-view ${skyClass}`;
            skyIndicator.querySelector('.sky-text').textContent = skyCondition;
        }

        function drawTrajectory(flight, origin, dest) {
            const canvas = document.getElementById('trajectoryCanvas');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Set up coordinate system
            const padding = 40;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;

            // Calculate relative positions
            const originX = padding;
            const destX = padding + width;
            const currentX = padding + (width * Math.random() * 0.8); // Simulate progress
            const flightY = padding + height / 2;

            // Draw flight path
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(originX, flightY);
            ctx.lineTo(currentX, flightY);
            ctx.stroke();

            // Draw remaining path (dashed)
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#95a5a6';
            ctx.beginPath();
            ctx.moveTo(currentX, flightY);
            ctx.lineTo(destX, flightY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw airports
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(originX, flightY, 8, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(destX, flightY, 8, 0, 2 * Math.PI);
            ctx.fill();

            // Draw aircraft
            ctx.fillStyle = '#f39c12';
            ctx.beginPath();
            ctx.arc(currentX, flightY, 10, 0, 2 * Math.PI);
            ctx.fill();

            // Add labels
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(flight.origin, originX, flightY + 25);
            ctx.fillText(flight.destination, destX, flightY + 25);
            ctx.fillText('‚úàÔ∏è', currentX, flightY - 15);
        }

        function drawAltitudeProfile(flight) {
            const canvas = document.getElementById('altitudeCanvas');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const padding = 30;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;

            // Generate altitude profile points
            const points = [];
            const segments = 10;
            for (let i = 0; i <= segments; i++) {
                const x = padding + (width * i / segments);
                let y;
                if (i <= 2) { // Takeoff
                    y = padding + height - (height * i / 2 * 0.8);
                } else if (i >= segments - 2) { // Landing
                    y = padding + height - (height * (segments - i) / 2 * 0.8);
                } else { // Cruise
                    y = padding + 20 + Math.random() * 20;
                }
                points.push({
                    x,
                    y
                });
            }

            // Draw altitude profile
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.stroke();

            // Draw current position marker
            const currentIndex = Math.floor(points.length * 0.6);
            const currentPoint = points[currentIndex];
            ctx.fillStyle = '#f39c12';
            ctx.beginPath();
            ctx.arc(currentPoint.x, currentPoint.y, 6, 0, 2 * Math.PI);
            ctx.fill();

            // Add altitude labels
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('40k ft', padding - 5, padding + 10);
            ctx.fillText('20k ft', padding - 5, padding + height / 2);
            ctx.fillText('0 ft', padding - 5, padding + height);
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 3440; // Earth's radius in nautical miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>

</html>